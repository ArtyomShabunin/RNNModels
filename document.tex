\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage[left=2.50cm, right=2.00cm, top=2.00cm, bottom=2.00cm]{geometry}
\usepackage[russian]{babel}
\usepackage[unicode, pdftex]{hyperref}
\usepackage{indentfirst}
\usepackage{gensymb}
\usepackage{tikz}

\DeclareGraphicsExtensions{.png,.jpg,.pdf}


%\title{Seq2Seq для моделирования ГТУ}
%\title{Рекуррентная нейронная сеть для моделирования ГТУ}
%\title{Моделирование газотурбинной установки с помощью рекуррентной нейронной сети}
\title{Рекуррентные нейронные сети для моделирования ГТУ. Специфика разработки и применения модели.}
\author{Артем Шабунин}
\date{\today}


\begin{document}
	
\maketitle

\section*{Аннотация.}

\section{Введение.}

Под детерминированными математическими моделями технологических объектов как правило понимают модели которые базируются на решении системы алгебраических и дифференциальных уравнений, описывающие физику процессов. Разработка такой модели - не простая задача, начиная от составления системы уравнений заканчивая ее решением, с ростом сложности моделируемого объекта растет и сложность разработки математической модели. Есть подходы и ПО которые упрощают процесс разработки. Так объектно-ориентированное моделированием позволяет декомпозировать сложную модель. ПО позволяет переиспользовать готовые модели, при желании, не вникая в заложенные в них уравнения. 

Модель можно представить в виде некоторой функции с параметрами, которые имеют физический смысл, но не могут быть измерены. К таким параметрам можно отнести: поправки на гидравлическое и аэродинамическое сопротивление, поправки на КПД, поправки на тепловые потери, поправки на пропускную способность и т.д. В конечном итоге все сводится к решению задачи оценки этих параметров, с целью максимального приближения модели к реальным данным \cite{Bezruchko}.

% Здесь нужно дать ссылку на книгу Б.П. Безручко, Д.А. Смирнов Математическое моделирование и хаотические временные ряды. [стр.201]

Очевидно что полностью обойтись без работы с данными, при разработке удовлетворительной по точности модели - невозможно. Можно ли получить хорошую модель без использования априорной информации используя только данные? Можно ли построить модель технологического объекта, используя только методы машинного обучения?
Рассмотрим несколько вариантом модели газотурбинной установки, каждая из которых представляет собой обученную рекуррентную нейронную сеть. Оценим потенциальные пути использования таких моделей в области предиктивной диагностики.





\section{Объект моделирования.}

Объектом моделирования является двухвальная газотурбинная установка ГТД-6РМ, принципиальная схема которой представлена на рисунке \ref{fig:gtd-schema}.

\begin{figure}[htb]
	\centering
	\begin{tikzpicture}[x=1.00mm, y=1.00mm, inner xsep=0pt, inner ysep=0pt, outer xsep=0pt, outer ysep=0pt]
		\node[anchor=south west] {\includegraphics[width=10.5cm]{img/gtd_schema}};
		\definecolor{L}{rgb}{1,0,0}
		\definecolor{T}{rgb}{0,0,1}
		\path[line width=0.30mm, draw=L] (5,5) -- (10,-3);
		\draw[T] (11,-4) node[anchor=base west]{\fontsize{11.38}{13.66}\selectfont \textcolor[rgb]{0, 0, 1}{1}};
		\path[line width=0.30mm, draw=L] (35,5) -- (40,-3);
		\draw[T] (41,-4) node[anchor=base west]{\fontsize{11.38}{13.66}\selectfont \textcolor[rgb]{0, 0, 1}{2}};
		\path[line width=0.30mm, draw=L] (65,5) -- (70,-3);
		\draw[T] (71,-4) node[anchor=base west]{\fontsize{11.38}{13.66}\selectfont \textcolor[rgb]{0, 0, 1}{3}};
		\path[line width=0.30mm, draw=L] (25,32) -- (30,40);
		\draw[T] (31,40) node[anchor=base west]{\fontsize{11.38}{13.66}\selectfont \textcolor[rgb]{0, 0, 1}{4}};	
		\path[line width=0.30mm, draw=L] (95,5) -- (100,-3);
		\draw[T] (101,-4) node[anchor=base west]{\fontsize{11.38}{13.66}\selectfont \textcolor[rgb]{0, 0, 1}{5}};
		\draw[T] (-2,40) node[anchor=base west]{\fontsize{11.38}{13.66}\selectfont \textcolor[rgb]{0, 0, 1}{воздух}};
		\draw[T] (60,40) node[anchor=base west]{\fontsize{11.38}{13.66}\selectfont \textcolor[rgb]{0, 0, 1}{уходящие газы}};
	\end{tikzpicture}
	\caption{Схема ГТД}
	\textit{1 – компрессор; 2 - турбина газогенератора; 3 - силовая турбина; 4 - камера сгорания; 5 - генератор}
	\label{fig:gtd-schema}
\end{figure}

Для исследования из всех сигналов ГТУ были выбраны те, которые относятся к основному технологическому процессу и имеют явные зависимости между собой. Выбранные сигналы были разбиты на внешние/управляющие воздействий и сигналы которые можно предсказать на основе внешних/управляющих воздействий.

\begin{description}
	\item Входные параметры (x):
	\begin{enumerate}
		\item указатель положения (УП) дозатора топлива, град
		\item давление топливного газа перед дозатором, МПа
		\item температура топливного газа перед дозатороом, \degree С
		\item выходной ток в цепи электростартера, А
		\item температура наружного воздуха, \degree С
		\item барометрическое давление, кПа
		\item относительная влажность наружного воздуха, %
		\item положение ЗЗО, \%

	\end{enumerate}
	\item Выходные параметры (y):
	\begin{enumerate}
		\item активная мощность генератора, кВт
		\item частота вращения ротора турбокомпрессора, об/мин
		\item частота вращения ротора силовой турбины, об/мин
		\item положение ВНА, \degree
		\item расход топливного газа, м3/час
		\item давление за компрессором, МПа
		\item температура воздуха перед ГТД, \degree С
		\item давление воздуха перед ГТД, кПа
		\item температура воздуха за компрессором, \degree С
		\item температура газов за силовой турбиной, \degree С
		\item давление газов за силовой турбиной, кПа
	\end{enumerate}
\end{description}

С точки зрения поиска решения задачи оптимизации достаточно важное значение имеет не зависимость (отсутствие корреляции) признаков которые являются входными параметрами модели. В противном случае возможно бесконечное число решений оптимизационной задачи. Все перечисленные входные признаки по своей природе - не зависимы, между ними нет жесткой связи. Единственным исключением является положение ЗЗО, это регулируемая заслонка на подаче греющего воздуха для исключения обледенения КВОУ и значение этого признака сильно коррелирует с температурой наружного воздуха. При этом по своей природы эти сигналы от друг друга не зависят, заслонка может принимать любые положения при любой температуре наружного воздуха, но алгоритмы автоматического управления объединяют их.

\section{Глубокое обучения для моделирования технологических объектов.}

Нейронные сети по разному могут использоваться в решении задач моделирования технологического оборудования. В \cite{Shabunin} рассматривался подход использования полносвязной нейронной сети для интерполяции относительно более сложной математической модели. Такое суррогатное моделирование использует машинное обучение для оптимизации модели, но для построения исходной модели необходимы экспертные знания о объекте моделирования.    

%\subsection{Рекуррентная нейронная сеть.}
% Multivariate input - univariate output is the most promising task for deep learning models. Deep neural networks can find complex predictive patterns in multivariate time series that classical methods fail to find. Usually, there is the primary time series sequence for a forecast and secondary ones. The secondary time series sequences contain auxiliary data that help determine the nature of a primary time series behaviour more accurately. [Ivan Gridin - Time Series Forecasting using Deep Learning_ Combining PyTorch, RNN, TCN, and Deep Neural Network Models to Provide Production-Ready Prediction Solutions-BPB Publications (2022)]

Глубокие нейронные сети могут самостоятельно находить сложные закономерности в многомерных временных рядах. Обычно есть первичная последовательность временных рядов для прогноза и вторичная. Вторичная последовательность содержит вспомогательные данные, которые помогают точнее определить характер поведения первичного временного ряда. Первичные данные предсказываются, вторичные - подается только на вход модели \cite{Gribin}. Если проводить аналогию с моделирование на основе решения систем дифференциальных и алгебраических уравнений, на вход такой модели подаются граничные условия, а на выходе имеем результат моделирования, внутри себя модель хранит скрытое состояние (которое также можно получить в результате моделирования).


%LSTM все забудет, поэтому не может хранить информацию о техническом состоянии
%
%Все-таки attention!
%Цель: создание модели которая сможет отслеживать техническое состояние 
%Не получится сделать attention без seq2seq архитектуры


Рекуррентные сети являются одной из наиболее подходящих разновидностей нейронных сетей для моделирования временных рядов, их развитие происходило главным образом в рамках решения задачи обработки текстов на естественном языке (NLP). Основное их преимущество по отношению к полносвязным и сверточным сетям, то что они могут работать с временными рядами произвольной длины. Рекуррентные сети работают с непрерывными последовательностями данных. В случае NLP это  последовательность слов (токенов), в случае промышленных данных - значения сигналов. Отличие заключается в том что в NLP каждая последовательность имеет начало и конец которые обозначаются специальными символами SOS (start of sequence) и EOS (end of a sequence), временной ряд не имеет определенных границ, начало временного ряда всегда продолжение другого ряда.

Простые рекуррентные сети плохо обучаются из-за проблем связанных с явлениями затухания и взрыва градиента. Для решения указанных проблемы были разработаны две разновидности RNN - LSTM и GRU. LSTM имеет более сложную архитектуру и лучше сохраняет информацию при работе с длинными последовательностями, GRU - более эффективная и быстрее обучается.\cite{habr_lstm_gru}

На рисунке \ref{fig:lstm} изображена схема модели RNN на основе ячеек LSTM для решения задачи моделирования ГТУ. Принципиально модель состоит из LSTM и полносвязного (FC) слоя. Каждая такая последовательность слоев на рисунке это одна и та же модель но в разный момент времени. На вход LSTM подается конкатенация векторов x и y (ранее определенные входные и выходные параметры) и два вектора скрытого состояния (hs). Далее выход LSTM попадает на вход FC слоя, на выходе которого мы получаем вектор выходных параметров в следующий момент времени. Начальное состояние такой модели инициализируется нулевыми векторами скрытого состояния, т.е. на первом шаге на вход LSTM, как и на остальных, подается два вектор скрытого состояния (на рисунке не обозначены).

Данные подаются последовательно: сначала момент времени 1, потом 2 и т.д. Первые n шагов такого расчета нужны чтобы сформировать актуальные векторы скрытого состояния, поэтому мы подаем по вход известные значения y, а значения на выходе модели нас не интересуют до шага n-1. На шаге n+1 и далее на вход модели подаются расчетные значения y, полученные на предыдущем шаге расчета. Если опять проводить аналогию с системой дифференциальных уравнений за n шагов мы определяем начальные параметры расчета.

Подаваемый на вход модели временной ряд не содержит информации о времени, поэтому это должен быть регулярный временной ряд, с одной дискретностью.

\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/lstm}
	\caption{LSTM рекуррентная сеть}
	\label{fig:lstm}
\end{figure}

Задачу поиска начальных условия можно решать с помощью отдельной рекуррентной нейронной сети на вход которой подаются входные и выходные параметры за определенный, предшествующий началу моделирования, промежуток времени. Итоговая модель будет состоять из двух рекуррентных сетей, такая архитектура называется sequence-to-sequence (seq2seq). Seq2seq – это модели глубокого обучения, достигшие больших успехов в таких задачах, как машинный перевод, суммаризация текста, аннотация изображений и др. Схематично модель изображена на рисунке \ref{fig:seq2seq}. Здесь вместо LSTM ячеек используется GRU, потому что архитектура Seq2Seq сильно увеличивает модель, а GRU как уже отмечалась, легковесна по сравнению с LSTM.

\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/seq2seq}
	\caption{Схема seq2seq нейронной сети}
	\label{fig:seq2seq}
\end{figure}

Seq2Seq состоит из двух моделей, которые могут быть по разному сконфигурированы: нет необходимости добавлять полносвязный слой в encoder; на вход декодера можно подавать только те параметры которые определяются внешними фактора, остальная информация передается через скрытое состояние; в encoder и decoder можно использовать временные ряды с разной дискретностью.


Механизм "внимания" позволяет декодеру на каждом временном шаге получать информацию от энкодера, при этом выделяется наиболее значащая для текущего шага информация. Принципиальная схема такой модели представлена на рисунке \ref{fig:att}. С помощью нейронной сети вычисляется "энергия" между каждым скрытым состоянием энкодера и текущим скрытым состоянием декодера. Скрытые состояния энкодера  взвешиваются с соответствующей "энергией" и поэлементно суммируются \cite{medium_brenner}.

\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/att}
	\caption{Схема seq2seq нейронной сети с механизмом внимания}
	\label{fig:att}
\end{figure}

В контексте рассматриваемой задачи механизм "внимания" может помочь модели извлечь и зафиксировать информацию о техническом состоянии объекта моделирования которая содержится в подаваемом на вход энкодера временном ряде.



%Третий вариант модели - что если в энкодере использовать сверточные слои. Смущает что изначально мы инициализирует энкодер с нулевым вектором скрытого состояния.


% Возможно преставленный на рисунке ниже принцип прогнозирования только на один шаг вперед более правильный. При этом вероятно он будет хуже работать при прогнозированиии на большое количество шагов вперед. Имеет смысл отдельно проанализировать это. На рисунке показан вариант IMS (iterated multi-step) forecasting, есть еще DMS (direct multi-step) forecasting. Кажется что DMS в рассматриваемом случае не применим.
%\begin{figure}[htb]
%	\centering\includegraphics[scale=0.8]{img/iterative-autoregressive-forecasting}
%	\caption{Demonstration of iterative, autoregressive forecasting}
%	\label{fig:iterative-autoregressive-forecasting}
%\end{figure}

\section{Исходные данные.}
Для обучения такого рода модели можно использовать любые данные - стационарные режимы, пусковые режимы, режимы останова и изменения нагрузки. Но используемые для обучения временные последовательности должны быть непрерывны с общей дискретностью. Временные ряды не должны содержать точек изменения состояния. Например при моделировании гидравлической системы, случай перехода на резервный насос, следует рассматривать как точку изменения состояния системы, которая делит временной ряд на две части - при использовании первого насоса и с использованием другого.

Для обучения моделей использовались данные за 2 года и 9 месяцев, из которых было выбрано 80 непрерывных временных рядов длиной до 3 часов. Временные ряды выбирались из условия наличия изменения электрической нагрузки: режимы пуска, останова, изменения электрической нагрузки. На основе этих данных был создан датасет, который позволяет формировать данные для обучения на основе этих 80 непрерывных временных рядов. Параметрами датасета является длина энкодера (n), длина декодера (m) и шаг с которым перемещается скользящее окно (data\_step). При параметрах n=60, m=600 и data\_step=120 получился датасет размером 6397 примеров. 


\section{Результаты моделирования.}

Были проведены эксперименты с обучением моделей всех перечисленных архитектур, ниже представлены некоторые результаты.

%\begin{figure}[htb]
%	\centering\includegraphics[scale=0.7]{img/plots/seq2seq-v1/300_values}
%	\caption{Предсказание на 300 сек.}
%	\label{fig:300_values2}
%\end{figure}
%
%\begin{figure}[htb]
%	\centering\includegraphics[scale=0.7]{img/plots/seq2seq-v1/300_errors}
%	\caption{Ошибка при предсказании на 300 сек.}
%	\label{fig:300_errors}
%\end{figure}
%
%\begin{figure}[htb]
%	\centering\includegraphics[scale=0.7]{img/plots/seq2seq-v1/8000_values}
%	\caption{Предсказание на 8000 сек.}
%	\label{fig:8000_values2}
%\end{figure}
%
%\begin{figure}[htb]
%	\centering\includegraphics[scale=0.7]{img/plots/seq2seq-v1/8000_errors}
%	\caption{Ошибка при предсказании на 8000 сек.}
%	\label{fig:8000_errors}
%\end{figure}

%\begin{figure}[htb]
%	\centering\includegraphics[scale=0.7]{img/plots/seq2seq-v1/gtu_map}
%	\caption{Характеристики ГТУ}
%	\label{fig:gtu_map}
%\end{figure}

%Наверное очень наивно предполагать, что Encoder сможет уловить особенности технического состояния объекта, на основе 120 секундного временного ряда.
%
%Такая модель может использоваться совместно с моделью в которую заложены физические уравнения.

\subsection{LSTM рекуррентная сеть.}

Проводилось несколько экспериментов с этой архитектурой, с разными значениями гиперпараметров. 

\begin{description}
	\item Значения при которых модель показала лучший результат:
	\begin{enumerate}
%		\item тип используемого модуля: LSTM;
		\item число LSTM слоев: 2;
		\item длина временного ряда на основании которого делается предсказание (n): 60;
		\item длина предсказываемого временного ряда (m): 600;
		\item размер вектора скрытого состояния (hidden size): 1024;
%		\item вероятность teacher force: линейно меняется от 1 до 0 в течение 40 эпох.
	\end{enumerate}
\end{description}

Гиперпараметры n и m фиксируются в процессе обучения, но при использовании модели эти параметры можно варьировать. Модель обученную предсказывать 600 точек можно использовать для предсказания временного ряда не ограниченной длины. Это утверждение справедливо для всех исследуемых моделей.

Было обучено 3 модели с разным набором входных и выходных параметров.

{\bf Вариант 1.} Входные (x) и выходные (y) данные принятые согласно представленному выше перечню.

{\bf Вариант 2.} В отличен от первого варианта на вход модели подается сигнал \texttt{активная мощность}, на выходе оценивается - \texttt{указатель положения дозатора топлива}.

{\bf Вариант 3.} В отличие от второго варианта на вход модели подается сигнал \texttt{частота вращения ротора силовой турбины}, на выходе оценивается - \texttt{выходной ток в цепи электростартера}.

Среднеквадратичная ошибка (MSE) по трем перечисленным вариантам:

\begin{center}
\begin{tabular}{ |c|c|c|c| } 
	\hline
	 & {\bf Вариант 1} & {\bf Вариант 2} & {\bf Вариант 3} \\ 
	{\bf train\_loss} & 0.00205 & 0.00125 & 0.00186 \\ 
	{\bf val\_loss} & 0.00215 & 0.00142 & 0.00243 \\
	{\bf epoch} & 49 & 39 & 39 \\ 
	\hline
\end{tabular}
\end{center}

Основанием чтобы попробовать разные сочетания входных и выходных параметров было то, что положение дозатора топлива иногда имеет не вполне адекватные значения. Когда этот параметр подается на вход модели его значения влияют на все выходные параметры. В случае если этот параметр на выходе модели, его значения влияют только на его ошибку.

На рисунке \ref{fig:res_lstm1} видно, что скачки значения положения дозатора создают аналогичные скачки на графике расчетных значений мощности (модель вариант 1). Такие же скачки присутствуют на графиках остальных расчетных параметров.

\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/fig1_lstm1}
	\centering\includegraphics[scale=0.8]{img/fig2_lstm1}
	\caption{Результат расчета модели Вариант 1}
	\label{fig:res_lstm1}
\end{figure}

График изменения архивных значений указателя положения дозатора топлива  показан на следующем рисунке \ref{fig:res_lstm2} в сопоставлении с расчетным значением, которое было получено при расчете по второму варианту модели. Видно что расчетные колебания этого параметра значительно меньше.

\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/fig1_lstm2}
	\centering\includegraphics[scale=0.8]{img/fig2_lstm2}
	\caption{Результат расчета модели Вариант 2}
	\label{fig:res_lstm2}
\end{figure}


\subsection{Seq2Seq}

\begin{description}
	\item Для сопоставления результатов, seq2seq модель исследовалась с похожими значениями гиперпараметров:
	\begin{enumerate}
		\item тип используемого модуля: GRU;
		\item число GRU слоев: 2;
		\item длина временного ряда который подается в энкодер (n): 60;
		\item длина предсказываемого временного ряда (m): 600;
		\item размер вектора скрытого состояния (hidden size): 1024.	
	\end{enumerate}
\end{description}

Здесь использовался другой тип рекуррентной ячейки - GRU. Этот тип рекуррентной ячейки имеет меньшее число параметров, что актуально при использовании архитектуры seq2seq, когда по сути обучается две нейронные сети.

Лучшие результаты на валидационной выборке показала модель которая обучалась с размером батча равным 16 (такой маленький размер батча был задан случайно).

Ниже метрики при обучении одной и той-же модели с разным размером батча - 16 и 256.

\begin{center}
	\begin{tabular}{ |c|c|c|c| } 
		\hline
		& {\bf 16} & {\bf 256} \\ 
		{\bf train\_loss} & 0.00005 & 0.00026 \\ 
		{\bf val\_loss} & 0.00005 & 0.00022 \\
		{\bf epoch} & 39 & 39 \\
		{\bf время обучения, ч} & 6.1 & 2.2 \\
		\hline
	\end{tabular}
\end{center}

На рисунке \ref{fig:val_loss_seq2seq} представлены графики изменения ошибки для двух вариантов обучения модели. Небольшой размер батча заставляет алгоритм обучения делать большее число шагов оптимизации, что приводит к быстрому снижению значения функции потерь при том же числе эпох обучения. Но при этом продолжительность обучения увеличивается. Вероятно что при той же продолжительности обучения при размере батча 256 модель придет к лучшим результатам. 

\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/val_loss_seq2seq_16}
	\centering\includegraphics[scale=0.8]{img/val_loss_seq2seq_256}
	\caption{График изменения ошибки во время обучения Seq2Seq}
	\label{fig:val_loss_seq2seq}
\end{figure}

На рисунке \ref{fig:res_seq2seq} представлены графики расчетных и архивных сигналов положения дозатора топлива и температуры газов за силовой турбиной, из которых видно качественное улучшение точности моделирования по отношение к раннее рассмотренным моделям.

\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/fig1_seq2seq}
	\centering\includegraphics[scale=0.8]{img/fig2_seq2seq}
	\caption{Результат расчета модели Seq2Seq}
	\label{fig:res_seq2seq}
\end{figure}


\subsection{Attention}

Основные параметры нейронной сети те же что в случае seq2seq, за исключением использования механизма внимания.

\begin{description}
	\item Метрики после обучения (MSE):
	\renewcommand\labelenumi{}
	\begin{enumerate}
		\item train\_loss - 0.00003
		\item val\_loss - 0.00007
		\item epoch - 39
		\item время обучения - 15.8 ч
		\item размер батча - 16
	\end{enumerate}
\end{description}

Видно, что на валидационной выборке применение механизма attention не повлияло на точность модели.

Ожидается, что {\it attention} позволяет зафиксировать ключевые особенности временного ряда прошедшего Encoder, и использовать эту информацию в Decoder. Мы фиксируем и запоминаем информацию о временном ряде которую получили при инициализации модели.


\begin{figure}[htb]
	\centering\includegraphics[scale=0.8]{img/fig1_att}
	\centering\includegraphics[scale=0.8]{img/fig2_att}
	\caption{Результат расчета модели Seq2Seq с Attention}
	\label{fig:res_att}
\end{figure}

\subsection{Проверка точности предсказания модели на новых данных.}

Модели машинного обучения, используемые в промышленности, часто сталкиваются с проблемой устаревания. Это связано с изменением внешних условий и технического состязания оборудования. Поэтому интересно посмотреть как модель работает с данными которые значительно новее тех на которых она обучалась.

%Проверить насколько хорошо модель работает на новых данных. Есть ли зависимость от того насколько далеки по времени новые данные от данных которые использовались при обучении модели?

На рисунках \ref{fig:new_data_seq2seq} и \ref{fig:new_data_seq2seq_att} представлены результаты моделирования режима изменения электрической нагрузки (снижение с 5.8 МВт до 4.6 МВт с последующим увеличением обратно до 5.8 МВТ). Рассматриваемый режим наблюдался спустя примерно 1 год относительно данных на которых выполнялось обучение моделей. На нижнем правом графиком дана невязка между нормализованными значениями.

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.4]{img/new_data_seq2seq}
	\caption{Результат расчета модели Seq2Seq на новых данных}
	\label{fig:new_data_seq2seq}
\end{figure}

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.4]{img/new_data_seq2seq_att}
	\caption{Результат расчета модели Seq2Seq с вниманием на новых данных}
	\label{fig:new_data_seq2seq_att}
\end{figure}

Видно, что обе модели (без "внимания" и с "вниманием") адекватно реагирует на все изменения входных параметров. При этом модель без "внимания", качественно, выглядит более точной. 

Выполненные расчеты позволяют рассчитывать на то что рассматриваемый подход позволит разрабатывать модели которые даже спустя год после обучения не утратят своей ценности. Разумеется для окончательных выводов необходимы более детальные исследования.


\subsection{Проверка точности предсказания на однотипной ГТУ, данные которой не использовались при обучении модели.}

%\textit{Насколько хорошо модель может быть обобщена на однотипное оборудование.}

Одной из сложностей применения машинного обучения в промышленности является то, что модели, обученные на одной единице оборудования, часто не могут быть напрямую использованы на аналогичном агрегате, даже если он относится к той же серии и имеет идентичные характеристики.

Ниже на рисунках \ref{fig:another_gt_seq2seq} и \ref{fig:another_gt_seq2seq_att} изображены графики с выходными данными моделей, на вход которых подавались данные по режиму изменения нагрузки (снижение нагрузки с 5.8 МВт до 3 МВт, и дальнейшее повышение обратно до 5.8 МВт). В отличие от предыдущего эксперимента данные взяты с другой аналогичной газотурбинной установки установленной на том же предприятии.

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.4]{img/another_gt_seq2seq}
	\caption{Результат расчета модели Seq2Seq на данных другой ГТУ}
	\label{fig:another_gt_seq2seq}
\end{figure}

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.4]{img/another_gt_seq2seq_att}
	\caption{Результат расчета модели Seq2Seq с вниманием на данных другой ГТУ}
	\label{fig:another_gt_seq2seq_att}
\end{figure}

%\begin{figure}[htb]
%	\centering\includegraphics[scale=0.8]{img/seq2seq-2}
%	\caption{Схема seq2seq нейронной сети (вариант №2)}
%	\label{fig:seq2seq-2}
%\end{figure}

Опять же, качественно, видно что обе модели хорошо отражают все возмущения входных параметров. Можно сделать вывод что после обучения на достаточном количестве данные в моделях формируются зависимости которые хорошо описываю физику технологического процесса.

\newpage
\subsection{Проверка способности модели запоминать состояние объекта при инициализации}

Временной ряд, подаваемый в модель при инициализации (данные, поступающие в encoder), содержит информацию двух типов:

\begin{enumerate}
	\item Параметры начальных условий, которые определяют стартовое состояние системы и влияют на расчет переходного процесса.
	\item Параметры технического состояния объекта, которые характеризуют его текущее состояние и не изменяются в рамках короткого временного интервала.
\end{enumerate}

Если модель инициализирована на основе данных, соответствующих одному и тому же техническому состоянию, но с разными начальными условиями, то при одинаковых входных воздействиях после инициализации мы получим разные переходные процессы, сходящиеся к одной и той же стационарной точке.

В данном случае предполагается, что временной ряд, используемый при инициализации, не содержит информации о динамике изменения технического состояния объекта. Если бы он содержал такую информацию, его длина должна была бы составлять несколько месяцев (что теоретически возможно, поскольку дискретность временных рядов encoder и decoder может различаться, но данный случай пока не рассматривается).

Следовательно, информация о техническом состоянии объекта, передаваемая в encoder, должна сохраняться без потерь на протяжении всего расчета.

Известно, что способность рекуррентных нейросетей сохранять информацию со временем ограничена: чем дальше точка во временном ряду от текущего момента, тем слабее её влияние на выходные значения. Это подтверждает рисунок \ref{fig:lstm_Qt_change}, на котором показано изменение выходного сигнала LSTM модели во времени.

Модель была инициализирована временными рядами, которые, вероятно, соответствовали разным техническим состояниям. Однако после инициализации входные данные были идентичны. В результате через короткий промежуток времени выходные сигналы стали совпадать, что свидетельствует о постепенном "забывании" моделью различий, связанных с начальными данными.

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.8]{img/lstm_Qt_change}
	\caption{Изменение сигнала при инициализации LSTM из разных состояний}
	\label{fig:lstm_Qt_change}
\end{figure}

Аналогичный эксперимент был проведен для Seq2Seq модели, и его результаты представлены на рисунке \ref{fig:s2s_Qt_change}. Видно, что выходные сигналы модели не сошлись к одному значению, однако при этом не наблюдалось установления стационарного режима.

Чтобы изучить поведение модели на больших временных интервалах, на вход подавался временной ряд длиной 100000 точек, в котором все входные параметры оставались неизменными (см. рисунок \ref{fig:s2s_Qt_Tt_synt_change}). Однако даже в этом случае модель не достигла стационарного состояния, хотя некоторые сигналы сравнялись.



\begin{figure}[htbp]
	\centering\includegraphics[scale=0.8]{img/s2s_Qt_change}
	\caption{Изменение сигнала при инициализации Seq2Seq из разных состояний}
	\label{fig:s2s_Qt_change}
\end{figure}

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.8]{img/s2s_Qt_synt_change}
	\centering\includegraphics[scale=0.8]{img/s2s_Tt_synt_change}
	\caption{Изменение сигнала при инициализации Seq2Seq из разных состояний}
	\label{fig:s2s_Qt_Tt_synt_change}
\end{figure}

Аналогичные расчеты были выполнены для Seq2Seq модели с механизмом внимания (см. \ref{fig:s2s_att_Qt_change} и \ref{fig:s2s_att_Qt_Tt_synt_change}). В каждом из этих случаев модель достигала уникального стационарного состояния. Эти результаты позволяют предположить, что модель с вниманием способна учитывать информацию о техническом состоянии объекта, содержащуюся во временном ряду, подаваемом при инициализации.


\begin{figure}[htbp]
	\centering\includegraphics[scale=0.8]{img/s2s_att_Qt_change}
	\caption{Изменение сигнала при инициализации Seq2Seq с вниманием из разных состояний}
	\label{fig:s2s_att_Qt_change}
\end{figure}

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.8]{img/s2s_att_Qt_synt_change}
	\centering\includegraphics[scale=0.8]{img/s2s_att_Tt_synt_change}
	\caption{Изменение сигнала при инициализации Seq2Seq с вниманием из разных состояний}
	\label{fig:s2s_att_Qt_Tt_synt_change}
\end{figure}


Проведенные эксперименты показали, что различные архитектуры моделей по-разному сохраняют информацию о начальных данных и техническом состоянии объекта. Наиболее стабильные результаты показала Seq2Seq модель с механизмом внимания. В каждом из экспериментов она приходила к уникальному стационарному состоянию, что указывает на способность учитывать информацию о техническом состоянии объекта, содержащуюся в инициализационном временном ряду. Это подтверждает эффективность механизма внимания в задачах, где важно учитывать долгосрочные зависимости и влияние начальных условий.

Таким образом, для корректного учета технического состояния объекта в моделях предсказания динамики наиболее перспективным подходом является использование механизмов внимания, позволяющих эффективно сохранять и использовать информацию о первоначальном состоянии системы.


\newpage
\subsection{Какую информацию модель извлекает из временного ряда при инициализации}

% расчетный файл test_attention_model_on_2year_data.ipynb

Состояние оборудования напрямую влияет на его эффективность. При деградации компонентов эффективность работы снижается, что можно оценивать через изменение эксплуатационных параметров. В случае газотурбинной установки (ГТУ) одним из таких показателей является отношение расхода топлива к электрической нагрузке. Однако этот показатель зависит не только от технического состояния, но и от нагрузки, а также от параметров атмосферного воздуха. Поэтому для корректного сравнения эффективности необходимо нормировать его, приведя к фиксированным значениям нагрузки и атмосферных условий.

Одним из возможных способов приведения является использование модели Seq2Seq с механизмом внимания. Если проинициализировать модель временными рядами, соответствующими разным техническим состояниям, а затем подать на вход одинаковые значения входных параметров, получим параметры которые соответствую одинаковым значениям внешних параметров, но разному техническому состоянию.

Для проверки этого подхода проведен эксперимент с моделью Seq2Seq Attention на годовом архиве эксплуатационных данных. Архив был разбит на недельные отрезки, в начале каждого из которых выбирался временной ряд длительностью 60 секунд с дискретностью 1 с. Таким образом, было получено 59 временных рядов, соответствующих различным состояниям оборудования. Поскольку техническое состояние ГТУ изменяется со временем, можно предположить, что каждый из отрезков соответствует разному состоянию. Точные данные о техническом состоянии отсутствуют но разумно предположить непрерывную естественную деградацию оборудования.


В процессе моделирования входные параметры изменялись следующим образом: от их значений в архивных данных (на момент инициализации) до фиксированных "нормальных" значений:

\begin{itemize}
	\item электрическая нагрузка - 5850.0 кВт;
	\item давление топливного газа - 1.8 МПа;
	\item температура топливного газа - 74.0 \degree С;
	\item токовая нагрузка стартера - 0.0 А;
	\item температура наружного воздуха - 15.0 \degree С;
	\item давление наружного воздуха - 101.3 кПа;
	\item относительная влажность наружного воздуха - 68.34 \%;
	\item положение ЗЗО - 0.0 \degree.
\end{itemize}

На рисунке \ref{fig:1y_exp_01} показана динамика изменения входных параметров (в относительных величинах) для одного из 59 расчетов. На протяжении первых 30 000 с параметры изменялись по линейному закону от значений в архивных данных до заданных "нормальных" величин. Затем в течение 10 000 с значения оставались постоянными, чтобы система достигла стационарного состояния.

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.7]{img/1y_exp_01}
	\caption{Графики изменения входных параметров при расчете приведенных значений.}
	\label{fig:1y_exp_01}
\end{figure}


На рисунке \ref{fig:1y_exp_02} представлена построенная по архивным данным зависимость температуры воздуха перед ГТД от температуры наружного воздуха (точки синего цвета) и аналогичная зависимость на основе выполненных расчетов, для случая который представлен на рисунке \ref{fig:1y_exp_01} (оранжевая линия).

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.8]{img/1y_exp_02}
	\caption{Зависимость температуры воздуха перед ГТД от температуры наружного воздуха во время расчетов по приведению параметров}
	\label{fig:1y_exp_02}
\end{figure}


Видно, что полученный в результата расчета диапазон изменния температуры воздуха перед компрессором значительно меньше диапазона изменения температуры наружного воздуха. Наблюдаемое поведение объясняется данными на основе которых обучалась модель, значения температуры наружного воздуха, которые использовались при инициализации слабо отличаются от значений, которые подавались в декодер. Что связанно с длиной временного ряда, за такой небольшой промежуток времени нельзя наблюдать существенного изменения температуры наружного воздуха.

%К сожалению такая модель все еще очень далека от физико-математической модели. Использование "внимания" дает возможность декодеру на каждом шаге расчета использовать информацию о действительных значениях рассчитываемых параметров, которые известны во время инициализации модели.

Для того чтобы обойти эту особенность данных, были внесены коррективы в процесс обучения модели. В 20\% случаев выполнялось перемешивание последовательностей подаваемых в энкодер. Таким образов каждый 5-й батч состоял из несвязных данных которые подавались в энкодер и декодер, т.е. температура наружного воздуха которая использовалась при инициализации могла существенно отличаться от значения которое использовалось в декодере. Такой подход должен научить модель меньше полагаться на данные по температуре наружного воздуха получаемые при инициализации и заставить ее фокусироваться на зависимости входных и выходных параметров. График изменения температур воздуха построенный с помощью новой модели представлен на рисунке \ref{fig:1y_exp_02} (зеленая линия).




%\begin{figure}[htbp]
%	\centering\includegraphics[scale=0.8]{img/1y_exp_2}
%	\caption{Графики изменения значения температуры наружного воздуха (входной параметр) и температуры воздуха перед компрессором (расчетный параметр) модель 2}
%	\label{fig:1y_exp_2}
%\end{figure}

На рисунке \ref{fig:1y_exp_3} представлено сопоставление приведенных расчетных значений расхода топлива по исходной, новой модели и архивных данных. Видно, что последний вариант модели лучше сгладил данные по расходу топлива. Кроме того, можно отметить общий тренд увеличения расхода топлива, что может свидетельствовать о деградации оборудования.

Таким образом, применение модели с механизмом внимания и адаптации процесса обучения позволило снизить влияние инициализационных данных и добиться учета технического состояния объекта.

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.8]{img/1y_exp_3}
	\caption{Графики изменения расхода топлива (фактические и приведенные значения)}
	\label{fig:1y_exp_3}
\end{figure}

\newpage
\section{Применение модели предсказания временных рядов для выявления аномалий и мониторинга технического состояния}

С помощью предсказания временных рядов можно решать несколько задач, рассмотрим поиск аномальных данных и отслеживание изменения технического состояния.

%Генерация непрерывной последовательности уникальных данных
%
%Можно попробовать выполнять сравнение пусков и остановов
%
%способна ли модель на основе, например суточной входной информации подаваемой на вход энкодера выдавать актуальную характеристику агрегата?
%
%что если учитывать изменение погоды?
%
%можно использовать для тренажера
%
%можно ли использовать для настройки регуляторов?



\subsection{Поиск аномальных данных}

Поиск аномалий - самая популярная задача которую в промышленности решают методами машинного обучения. Машинное обучение, относительно молодая и быстро развивающаяся наука. Поэтому зачастую многие ее понятия не имеют устоявшегося определения. Одно из определений аномалий в данных выглядит следующим образов - это отклонения от ожидаемых значений, которые могут указывать на ошибки, выбросы или необычные события. Получается что аномалии это данные которые не соответствуют некоторому, зачастую субъективному, их пониманию. Не следует путать понятия {\it аномалия} и {\it дефект}.

Дефект - каждое  отдельное несоответствие  объекта  требованиям, установленным документацией \cite{gost_27002}. Наличие дефекта можно детектировать по отклонению контролируемых параметров от заданных уставок.
%в процессе регламентных работ и визуальном осмотре.
Обнаружения дефектов на основе изменрительных сигналов - задача системы АСУ ТП

В контексте данной работы аномалии в данных включаю в себя данные, которые содержат дефекты, но не ограничиваются ими. Наибольший интерес представляют аномалий которые  являются симптомами зарождающегося дефекта, что потенциально дает возможность предотвратить его появление.

Из определения аномальных данных решением задачи является разработка модели которая позволит сравнить данные с их ожидаемым значением, ожидаемые значения должны быть результатом математического моделирования.

Таким условиям удовлетворяют модели типа автокодировщиков. Их основная идея заключается в том, чтобы восстановить на выходе входные данные с минимальными потерями информации. Внутри модели существует узкое место – сжатое представление входных данных, что не позволяет ей запомнить все детали входного сигнала. Математически такой подход можно выразить следующим образом:

$$\hat{y},\hat{x} = f(x,y)$$

Аналогичная запись для моделей рассматриваемых в рамках данной статьи выглядит следующим образов:

$$\hat{y} = f(x)$$

В чем отличие между этими моделями с точки зрения решения задачи поиска аномалий:
\begin{enumerate}
	\item во втором случае модель на входе не получает информации относительно сравниваемых сигналов, что представляется более "честным". Каждому вектору х соответствует один вектор y, если в вектор x добавить еще один элемент, то каждому значению этого элемента соответствовать свой y, таким образом модель становится менее детерминированной. Меньшее число входных параметров позволяется накладывать менее строгие требования к разметке исходных данных.
	\item во втором случае сравнение происходит только по сигналам которые относятся к $y$, если аномальными являются значение одного из сигналов x, то истинный источник аномалии останется неизвестен. При этом разница между $y$ и $\hat{y}$ позволит обнаружить наличие аномалии.
\end{enumerate}

Детерминированные модели на основе LSTM слоев могут использоваться для решения задачи детекции аномальных данных, такие модели даже имею некоторые преимущества по отношении с популярным способом решения такой задачи на основе автокодировщиков.


Для обнаружения аномалии необходимо иметь информацию о диапазоне возможных значений сравниваемого сигнала
 
Вероятностный прогноз — это когда прогноз, помимо значения прогнозируемой величины, также отражает ее неопределенность. Вероятностное прогнозирование — это метод прогнозирования будущих событий или результатов вместе с соответствующими вероятностями или уровнями достоверности. Этот подход учитывает неопределенность в процессе прогнозирования \cite{joseph_tackes}.

\textbf{Probability Density Function (PDF)} - один из наиболее распространенных методов вероятностного прогнозирования, особенно в области глубокого обучения, из-за простоты реализации. Суть метода в том, что модель вместо $\hat{y}$ возвращает плотность вероятности этой величины $p(\hat{y})$. Например, если мы предположим, что прогноз составлен на основе нормального распределения, мы можем написать:

$$\hat{y} = N(\mu, \sigma)$$

Нужно обучить модель, которая будет предсказывать $\mu$ и $\sigma$ для каждого сигнала.

В данной работе обучена модель, основанная на архитектуре, которая была предложена в \cite{wang_smola}. Принципиально это seq2seq модель декодер которой состоит из двух отдельных частей одна из которых предсказывает $\mu$, другая $\sigma$. В качестве функции потерь используется отрицательный логарифм правдоподобия.
 
На рисунках \ref{fig:fig1_anomaly} и \ref{fig:fig2_anomaly} представлены результаты моделирования двух режимов. Видно, что сигналы имеют разные значения стандартного отклонения.  Чем менее надежный сигнал тем выше стандартное отклонение. Обозначенный на рисунках диапазон значений соответствует $\pm3\sigma$.
 
 \begin{figure}[htbp]
 	\centering\includegraphics[scale=0.4]{img/fig1_anomaly}
 	\caption{Результат расчета модели режим изменения нагрузки}
 	\label{fig:fig1_anomaly}
 \end{figure}
 
 \begin{figure}[htbp]
 	\centering\includegraphics[scale=0.4]{img/fig2_anomaly}
 	\caption{Результат расчета модели пусковой режим}
 	\label{fig:fig2_anomaly}
 \end{figure}
 
Самый большой недостаток этого метода заключается в том, что мы ограничиваем вывод одним из параметризованных распределений, в данном случае нормальным. Есть методы которые не требует предположения о каком-либо параметрическом распределении, но все равно получает интервалы прогнозирования: прогнозирование с учетом quantile loss, Monte Carlo Dropout.

Следует также отметить, что вероятностный подход не является особенностью seq2seq моделей, его можно использовать и в случаем автокодировщиков.


\newpage
\subsection{Оценка технического состояния}

%Интуиция.

%Рекуррентная сеть использует для прогнозирования скрытое состояние, интуитивно такое состояние в рассматриваемой модели содержит информация техническом состоянии объекта и его эксплуатационном режиме. Представляет интерес отслеживание изменения технического состояния объекта по вектору скрытого состояния.
%
%С помощью приведения к нормальным значениям входных параметров, возможно выполнить сравнение технического состояние в разные моменты времени через приведенные показатели эффективности как было показано выше.

%Сценарии использования:
%
%\textbf{Оценка стационарности режима. } На вход декодера подается вектор входных параметров который использовался на последнем шаге энкодера, вследствие чего выход модели и скрытое состояние должны прийти к стационарному состоянию. После стабилизации можно сравнить первый и последний вектора скрытого состояния, различие между ними должно быть связано с нестационарностью исходного (после энкодера) режима.
%
%\textbf{Оценка стационарного режима. } Полученные после достижения стационарного режима векторы можно сравнивать с аналогичными векторами полученными ранее и тем самым отслеживать изменение этих состояний, что в том числе может отражать изменение технического состояния. 

%\textbf{Построение диаграмм режимов.}
%С помощью модели с вниманием были построены две группы зависимостей с инициализацией через данные между которыми прошел значительный промежуток времени (см. рисунок \ref{fig:diagram}). Все входные параметры были приведены к одним значениям. Видно, что полученные характеристики (зеленые и синие) значительно отличаются, что можно объяснить особенностями технического состояния оборудования в соответствующие моменты времени. Полученные зависимости монотонны, не пресекаются (почти не пересекаются), выглядят достаточно логично с точки зрения физики.

Используя принцип приведения, о котором уже говорилось выше, с помощью моделей "с вниманием" были сгенерировать данные, характеризующие работу ГТУ в диапазоне электрических нагрузок и температуры наружного воздуха, для двух разных состояний ГТУ (модель была проинициализирована с помощью данных которые были получены через со значительно разностью по времени). Значения входных параметров, за исключением мощности и температуры наружного воздуха принимались одинаковыми во всех расчетах. На рисунки \ref{fig:diagram_1} представлены графики основных показателей ГТУ на основе сгенерированных данных, точечные линии - расчетные данный при инициализации относительно свежими данными, сплошные линии - инициализация относительно старыми данными. Видно, что в диапазоне плюсовых температур наружного воздуха все характеристики выглядят достаточно физично, наблюдается рост показателей с увеличением нагрузки и температуры наружного воздуха, линии соответствующие разным температурам наружного воздуха не пересекаются. Для некоторых показателей (расход топлива и давление за компрессором) зависимости меняются при переходе к отрицательным температурам наружного воздуха, что вероятно связано с работой системы антиобледенения. Расчет выполнялся при условии что система антиобледенения не работает, что при таких температурах заставляет модель работать в области где нет архивных данных, этот вопрос требует отдельной проработки. Также видно что при инициализации разным состояние наблюдается сдвиг характеристик, при этом общая закономерность не меняется. Таким образом модель способна улавливать разницу между разным состонием ГТУ на основе значений сигналов, а с помощью такого рода диаграмм эту разницу можно интерпретировать. Так смещение характеристик по температуре газов за ГТУ или воздуха за компрессором может говорить о снижении эффективноти турбины или компрессора, соответственно.

\begin{figure}[htbp]
	\centering\includegraphics[scale=0.4]{img/diagram_1}
	\caption{Диаграмма}
	\label{fig:diagram_1}
\end{figure}




\newpage
\section{Вывод.}

На постановленный в начале вопрос о возможности разработки моделей технологического оборудования, в частности ГТУ, пользуясь только методами машинного обучения можно ответить утвердительно. В данной работе были разработаны математические модели на базе рекуррентных нейронный сетей, которые корректно моделируют работу оборудования. При этом экспертная составляющая при разработке таких моделей свелась к отбору данных и разделению сигналов на входные и выходные параметры. При этом отбор данных выполнялся по принципу выделения наиболее разнообразных временных рядов, для чего экспертные знания не играют большой роли. Очистка дынных от потенциальных выбросов перед обучением моделей не выполнялась.




%Вывод должен содержать ответы на два поставленные во введении вопроса.
%
%Можно ли получить хорошую модель без использования априорной информации используя только данные? Можно ли построить модель технологического объекта, используя только методы машинного обучения?

\newpage
\begin{thebibliography}{}
	\bibitem{Bezruchko} Б.П. Безручко, Д.А. Смирнов Математическое моделирование и хаотические временные ряды.
	\bibitem{Shabunin} Шабунин, А.С. Нейросетевые модели технологического оборудования в системе мониторинга и предиктивной аналитики [Текст] / А.С. Шабунин, М.Ю. Чернецкий, Р.В. Осиповский // Электрические станции. - 2023. - №11. - С. 50 - 57
	\bibitem{Gribin} Ivan Gridin - Time Series Forecasting using Deep Learning: Combining PyTorch, RNN, TCN, and Deep Neural Network Models to Provide Production-Ready Prediction Solutions-BPB Publications (2022)
	\bibitem{gost_27002} ГОСТ 27.002-2015 Надежность в технике. Термины и определения
	\bibitem{habr_lstm_gru} https://habr.com/ru/companies/mvideo/articles/780774/
	\bibitem{medium_brenner} https://medium.com/@maxbrenner-ai/implementing-seq2seq-models-for-efficient-time-series-forecasting-88dba1d66187
	\bibitem{joseph_tackes} Modern time series forecasting with python. Manu Roseph, Jeffrey Tackes
	\bibitem{wang_smola} Deep Factors for Forecasting Yuyang Wang Alex Smola Danielle C. Maddix 
\end{thebibliography}



\end{document}